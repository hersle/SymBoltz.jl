<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Solving models · SymBoltz</title><meta name="title" content="Solving models · SymBoltz"/><meta property="og:title" content="Solving models · SymBoltz"/><meta property="twitter:title" content="Solving models · SymBoltz"/><meta name="description" content="Documentation for SymBoltz."/><meta property="og:description" content="Documentation for SymBoltz."/><meta property="twitter:description" content="Documentation for SymBoltz."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.webp" alt="SymBoltz logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">SymBoltz</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../getting_started/">Getting started</a></li><li><a class="tocitem" href="../automatic_differentiation/">Using automatic differentiation</a></li><li><a class="tocitem" href="../extended_models/">Extending models</a></li><li><a class="tocitem" href="../parameter_fitting/">Fitting parameters</a></li><li><a class="tocitem" href="../forecasting/">Fisher forecasting</a></li></ul></li><li><span class="tocitem">Building models</span><ul><li><a class="tocitem" href="../components/">Components (submodels)</a></li><li><a class="tocitem" href="../models/">Cosmologies (full models)</a></li><li><a class="tocitem" href="../unstructured/">Unstructured ΛCDM model</a></li></ul></li><li class="is-active"><a class="tocitem" href>Solving models</a><ul class="internal"><li><a class="tocitem" href="#Creating-the-problem"><span>Creating the problem</span></a></li><li><a class="tocitem" href="#Updating-the-parameters"><span>Updating the parameters</span></a></li><li><a class="tocitem" href="#Solving-the-problem"><span>Solving the problem</span></a></li><li><a class="tocitem" href="#Accessing-the-solution"><span>Accessing the solution</span></a></li><li><a class="tocitem" href="#Plotting-the-solution"><span>Plotting the solution</span></a></li><li><a class="tocitem" href="#Solve-background-and-perturbations-directly"><span>Solve background and perturbations directly</span></a></li><li><a class="tocitem" href="#Choice-of-ODE-solver"><span>Choice of ODE solver</span></a></li></ul></li><li><a class="tocitem" href="../plot/">Plotting and visualization</a></li><li><a class="tocitem" href="../observables/">Observable quantities</a></li><li><a class="tocitem" href="../comparison/">Comparison to CLASS</a></li><li><a class="tocitem" href="../benchmarks/">Performance and benchmarks</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Solving models</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Solving models</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/hersle/SymBoltz.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/hersle/SymBoltz.jl/blob/main/docs/src/solve.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Solving-models"><a class="docs-heading-anchor" href="#Solving-models">Solving models</a><a id="Solving-models-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-models" title="Permalink"></a></h1><p>First create a symbolic cosmological model:</p><pre><code class="language-julia hljs">using SymBoltz
M = SymBoltz.ΛCDM()</code></pre><h2 id="Creating-the-problem"><a class="docs-heading-anchor" href="#Creating-the-problem">Creating the problem</a><a id="Creating-the-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-the-problem" title="Permalink"></a></h2><p>Once the symbolic <a href="../models/#Cosmologies-(full-models)">cosmological model</a> <code>M</code> has been constructed, it can be turned into a numerical problem: For example:</p><pre><code class="language-julia hljs">pars = SymBoltz.parameters_Planck18(M)
prob = CosmologyProblem(M, pars)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Cosmology problem for model <span class="sgr1">ΛCDM</span>
<span class="sgr1">Stages:</span>
  Background: 5 unknowns, 0 splines
  Perturbations: 54 unknowns, 5 splines
<span class="sgr1">Parameters &amp; initial conditions:</span>
  c₊Ω₀ = 0.26447041034523616
  b₊Ω₀ = 0.04936780993111075
  γ₊T₀ = 2.7255
  b₊YHe = 0.2454
  h₊m_eV = 0.02
  h = 0.6736
  h₊N = 3.0
  I₊ns = 0.965
  ν₊Neff = 2.99
  I₊ln_As1e10 = 3.0440461338325417</code></pre><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SymBoltz.CosmologyProblem" href="#SymBoltz.CosmologyProblem"><code>SymBoltz.CosmologyProblem</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">CosmologyProblem(
    M::System, pars::Dict, shoot_pars = Dict(), shoot_conditions = [];
    ivspan = (1e-6, 100.0), bg = true, pt = true, spline = true, debug = false, fully_determined = true, jac = false, kwargs...
)</code></pre><p>Create a numerical cosmological problem from the model <code>M</code> with parameters <code>pars</code>. Optionally, the shooting method determines the parameters <code>shoot_pars</code> (mapped to initial guesses) such that the equations <code>shoot_conditions</code> are satisfied at the final time.</p><p>If <code>bg</code> and <code>pt</code>, the model is split into the background and perturbations stages. If <code>spline</code> is a <code>Bool</code>, it decides whether all background unknowns in the perturbations system are replaced by splines. If <code>spline</code> is a <code>Vector</code>, it rather decides which (unknown and observed) variables are splined.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/hersle/SymBoltz.jl/blob/f9eb943ad4dc0020484bbe54acb6973a64ec2c3c/src/solve.jl#L108-L120">source</a></section></article><h2 id="Updating-the-parameters"><a class="docs-heading-anchor" href="#Updating-the-parameters">Updating the parameters</a><a id="Updating-the-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Updating-the-parameters" title="Permalink"></a></h2><p>Constructing a <code>CosmologyProblem</code> is an <strong>expensive</strong> operation that compiles all the symbolics down to numerics. It is not necessary to repeat this just to update parameter values. To do so, use the function <code>parameter_updater</code> that returns a function that quickly creates new problems with updated parameter values:</p><pre><code class="language-julia hljs">probmaker = parameter_updater(prob, [M.g.h, M.c.Ω₀]) # fast factory function
prob = probmaker([0.70, 0.27]) # create updated problem</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Cosmology problem for model <span class="sgr1">ΛCDM</span>
<span class="sgr1">Stages:</span>
  Background: 5 unknowns, 0 splines
  Perturbations: 54 unknowns, 5 splines
<span class="sgr1">Parameters &amp; initial conditions:</span>
  c₊Ω₀ = 0.27
  b₊Ω₀ = 0.04936780993111075
  γ₊T₀ = 2.7255
  b₊YHe = 0.2454
  h₊m_eV = 0.02
  h = 0.7
  h₊N = 3.0
  I₊ns = 0.965
  ν₊Neff = 2.99
  I₊ln_As1e10 = 3.0440461338325417</code></pre><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SymBoltz.parameter_updater" href="#SymBoltz.parameter_updater"><code>SymBoltz.parameter_updater</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">parameter_updater(prob::CosmologyProblem, idxs; kwargs...)</code></pre><p>Create and return a function that updates the symbolic parameters <code>idxs</code> of the cosmological problem <code>prob</code>. The returned function is called with numerical values (in the same order as <code>idxs</code>) and returns a new problem with the updated parameters.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/hersle/SymBoltz.jl/blob/f9eb943ad4dc0020484bbe54acb6973a64ec2c3c/src/solve.jl#L225-L230">source</a></section></article><h2 id="Solving-the-problem"><a class="docs-heading-anchor" href="#Solving-the-problem">Solving the problem</a><a id="Solving-the-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-the-problem" title="Permalink"></a></h2><p>The (updated) problem can now be solved for some wavenumbers:</p><pre><code class="language-julia hljs">using Unitful, UnitfulAstro
ks = 10 .^ range(-5, +1, length=100) / u&quot;Mpc&quot;
sol = solve(prob, ks)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Cosmology solution for model <span class="sgr1">ΛCDM</span>
<span class="sgr1">Stages:</span>
  Background: return code <span class="sgr32">Terminated</span>; solved with Rodas4P; 1305 points
  Perturbations: return codes <span class="sgr32">Success</span>; solved with KenCarp4; 58-1346 points; x100 k ∈ [0.042827494000000015, 42827.49400000001] H₀/c (interpolation in-between)</code></pre><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CommonSolve.solve-Tuple{CosmologyProblem, AbstractArray}" href="#CommonSolve.solve-Tuple{CosmologyProblem, AbstractArray}"><code>CommonSolve.solve</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">CommonSolve.solve(args...; kwargs...)</code></pre><p>Solves an equation or other mathematical problem using the algorithm specified in the arguments. Generally, the interface is:</p><pre><code class="language-julia hljs">CommonSolve.solve(prob::ProblemType,alg::SolverType; kwargs...)::SolutionType</code></pre><p>where the keyword arguments are uniform across all choices of algorithms.</p><p>By default, <code>solve</code> defaults to using <code>solve!</code> on the iterator form, i.e.:</p><pre><code class="language-julia hljs">solve(args...; kwargs...) = solve!(init(args...; kwargs...))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/CommonSolve.jl/blob/v0.2.4/src/CommonSolve.jl#L3-L22">source</a></section><section><div><pre><code class="language-julia hljs">function solve(
    prob::CosmologyProblem, ks::Union{Nothing, AbstractArray} = nothing;
    bgopts = (alg = DEFAULT_BGALG, reltol = 1e-9, abstol = 1e-9),
    ptopts = (alg = DEFAULT_PTALG, reltol = 1e-8, abstol = 1e-8),
    shootopts = (alg = DEFAULT_SHOOTALG, abstol = 1e-5),
    thread = true, verbose = false, kwargs...
)</code></pre><p>Solve the cosmological problem <code>prob</code> up to the perturbative level with wavenumbers <code>ks</code> (or only to the background level if it is empty). The options <code>bgopts</code> and <code>ptopts</code> are passed to the background and perturbations ODE <code>solve()</code> calls, and <code>shootopts</code> to the shooting method nonlinear <code>solve()</code>. If <code>threads</code>, integration over independent perturbation modes are parallellized.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/hersle/SymBoltz.jl/blob/f9eb943ad4dc0020484bbe54acb6973a64ec2c3c/src/solve.jl#L269-L282">source</a></section></article><h2 id="Accessing-the-solution"><a class="docs-heading-anchor" href="#Accessing-the-solution">Accessing the solution</a><a id="Accessing-the-solution-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-the-solution" title="Permalink"></a></h2><p>The returned solution <code>sol</code> can be conveniently accessed to obtain any variable <code>y</code> of the model <code>M</code>:</p><ul><li><code>sol(y, τ)</code> returns the <em>background</em> variable(s) <span>$y(τ)$</span> as a function of conformal time(s) <span>$τ$</span>. It interpolates between time points using the ODE solver&#39;s custom-tailored interpolator.</li><li><code>sol(y, τ, k)</code> returns the <em>perturbation</em> variable(s) <span>$y(τ,k)$</span> as a function of the wavenumber(s) <span>$k$</span> and conformal time(s) <span>$τ$</span>. It also interpolates linearly between the logarithms of the wavenumbers passed to <code>solve</code>.</li></ul><p>Note that <code>y</code> can be any symbolic variables in the model <code>M</code>, and even expressions thereof. <em>Unknown</em> variables are part of the state vector integrated by the ODE solver, and are returned directly from its solution. <em>Observed</em> variables or expressions are functions of the unknowns, and are automatically calculated from the equations that define them in the symbolic model. For example:</p><pre><code class="language-julia hljs">τs = sol[M.τ] # get time points used in the background solution
ks = [1e-3, 1e-2, 1e-1, 1e0] / u&quot;Mpc&quot; # wavenumbers
as = sol(M.g.a, τs) # scale factors
Ωms = sol((M.b.ρ + M.c.ρ) / M.G.ρ, τs) # matter-to-total density ratios
κs = sol(M.b.κ, τs) # optical depths
Φs = sol(M.g.Φ, τs, ks) # metric potentials
Φs_over_Ψs = sol(M.g.Φ / M.g.Ψ, τs, ks) # ratio between metric potentials</code></pre><h2 id="Plotting-the-solution"><a class="docs-heading-anchor" href="#Plotting-the-solution">Plotting the solution</a><a id="Plotting-the-solution-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-the-solution" title="Permalink"></a></h2><p>SymBoltz.jl includes <a href="https://docs.juliaplots.org/latest/recipes/">plot recipes</a> for easily visualizing the solution. It works similarly to the solution accessing: call <code>plot(sol, [wavenumber(s),] x_expr, y_expr)</code> to plot <code>y_expr</code> as a function of <code>x_expr</code>. For example, to plot some of the same quantities that we obtained above:</p><pre><code class="language-julia hljs">using Plots
p1 = plot(sol, log10(M.g.a), (M.b.ρ + M.c.ρ) / M.G.ρ)
p2 = plot(sol, log10(M.g.a), log10(abs(M.b.κ)))
p3 = plot(sol, log10(M.g.a), M.g.Φ / M.g.Ψ, ks[1:3]) # exclude last k, where Φ and Ψ cross 0
plot(p1, p2, p3, layout=(3, 1), size=(600, 800))</code></pre><img src="ec166db3.svg" alt="Example block output"/><p>More examples are shown on the <a href="../models/#Cosmologies-(full-models)">models page</a>.</p><h2 id="Solve-background-and-perturbations-directly"><a class="docs-heading-anchor" href="#Solve-background-and-perturbations-directly">Solve background and perturbations directly</a><a id="Solve-background-and-perturbations-directly-1"></a><a class="docs-heading-anchor-permalink" href="#Solve-background-and-perturbations-directly" title="Permalink"></a></h2><p>For lower-level control, you can solve the background and perturbations separately:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SymBoltz.solvebg" href="#SymBoltz.solvebg"><code>SymBoltz.solvebg</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">solvebg(bgprob::ODEProblem; alg = DEFAULT_BGALG, reltol = 1e-9, abstol = 1e-9, verbose = false, kwargs...)</code></pre><p>Solve the background cosmology problem <code>bgprob</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/hersle/SymBoltz.jl/blob/f9eb943ad4dc0020484bbe54acb6973a64ec2c3c/src/solve.jl#L325-L329">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SymBoltz.solvept" href="#SymBoltz.solvept"><code>SymBoltz.solvept</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">solvept(ptprob::ODEProblem, bgsol::ODESolution, ks::AbstractArray, bgsplinepar; alg = DEFAULT_PTALG, reltol = 1e-8, abstol = 1e-8, output_func = (sol, i) -&gt; (sol, false), thread = true, verbose = false, kwargs...)</code></pre><p>Solve the perturbation cosmology problem <code>ptprob</code> with wavenumbers <code>ks</code>. A background solution <code>bgsol</code> must be passed (see <code>solvebg</code>), and a parameter <code>bgsplinepar</code> that refers to a spline in the perturbation problem of background unknowns. If <code>thread</code> and Julia is running with multiple threads, the solution of independent wavenumbers is parallellized. The return value is an <code>EnsembleSolution</code> over all <code>ks</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/hersle/SymBoltz.jl/blob/f9eb943ad4dc0020484bbe54acb6973a64ec2c3c/src/solve.jl#L393-L400">source</a></section></article><h2 id="Choice-of-ODE-solver"><a class="docs-heading-anchor" href="#Choice-of-ODE-solver">Choice of ODE solver</a><a id="Choice-of-ODE-solver-1"></a><a class="docs-heading-anchor-permalink" href="#Choice-of-ODE-solver" title="Permalink"></a></h2><p>In principle, models can be solved with any <a href="https://docs.sciml.ai/DiffEqDocs/stable/solvers/ode_solve/">DifferentialEquations.jl ODE solver</a>. But most cosmological models have very stiff Einstein-Boltzmann equations that can only be solved by implicit solvers, while explicit solvers usually fail. For the <a href="../models/#Standard-ΛCDM">standard ΛCDM model</a>, some good solvers are:</p><ul><li><code>Rodas4P</code>: Slow for large systems. Very accurate. Handles extreme stiffness. Default background solver.</li><li><code>Rodas5P</code>: Slow for large systems. Very accurate. Handles severe stiffness.</li><li><code>KenCarp4</code> (and <code>KenCarp47</code>): Fast. Handles medium stiffness. Default perturbation solver.</li><li><code>Kvaerno5</code>: Behaves similar to <code>KenCarp4</code>. Slightly more accurate. Slightly slower.</li><li><code>TRBDF2</code>: Very fast. Decent accuracy. Handles severe stiffness.</li></ul><p>See also the <a href="../benchmarks/#Performance-and-benchmarks">solver benchmarks</a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../unstructured/">« Unstructured ΛCDM model</a><a class="docs-footer-nextpage" href="../plot/">Plotting and visualization »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Wednesday 15 October 2025 19:06">Wednesday 15 October 2025</span>. Using Julia version 1.12.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
